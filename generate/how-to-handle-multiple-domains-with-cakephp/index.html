
<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">

    <title>How to handle multiple domains with CakePHP</title>

    
    <meta name="author" content="Stef van den Ham">
    
    <link rel="stylesheet" href="/assets/themes/ghminimal/css/styles.css">
    <link rel="stylesheet" href="/assets/themes/ghminimal/css/pygment_trac.css">

    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header class="main">
        <hgroup>
          <h1><a href="/">Mindthecode</a></h1>
          
          <h2>Rambling about code</h2>
          
        </hgroup>
        <ul class="buttons">
          <li><a href="http://github.com/hyra/" rel="me">Code <strong>GitHub</strong></a></li>
          <li><a href="http://www.linkedin.com/in//" rel="me">Connect <strong>LinkedIn</strong></a></li>
          <li><a href="http://twitter.com/stefvdham/" rel="me">Follow <strong>Twitter</strong></a></li>
        </ul>
      </header>
      <section class="main">
        
<article class="post">
	<header>
		<h1>How to handle multiple domains with CakePHP</h1>
		<p>Published on <time datetime="2011-05-22T22:49:00+02:00" pubdate>
			May 22, 2011
		</time></p>
	</header>

	<p>Lately, we’ve been working with multiple environments/servers for our websites to be able to have them approved by clients before going live. However, following set up can also work nicely when you develop your sites locally and don’t want to keep changing the configuration every time you upload it.</p>

<!--more-->

<h2 id="setting-up-the-database-config-file">Setting up the database config file</h2>

<p>So, what changes in your config? Not all that much. Let’s have a look at the default database.php config file</p>

<pre><code>class DATABASE_CONFIG {

    var $default = array(
    'driver' =&gt; 'mysql',
    'persistent' =&gt; false,
    'host' =&gt; 'localhost',
    'login' =&gt; 'user',
    'password' =&gt; 'password',
    'database' =&gt; 'database_name',
    'prefix' =&gt; '',
    );

    var $test = array(
    'driver' =&gt; 'mysql',
    'persistent' =&gt; false,
    'host' =&gt; 'localhost',
    'login' =&gt; 'user',
    'password' =&gt; 'password',
    'database' =&gt; 'test_database_name',
    'prefix' =&gt; '',
    );
}
</code></pre>

<p>The <code>$default</code> database config is used when you don’t specify anything. The <code>$test</code> database is used by SimpleTest. Let’s say you want to have a <code>local</code> environment and one for when you’re on your live/production server. Below is the database config I use</p>

<pre><code>class DATABASE_CONFIG {

    var $local = array(
        'driver' =&gt; 'mysql',
        'persistent' =&gt; false,
        'encoding' =&gt; 'utf8',
        'host' =&gt; 'localhost',
        'login' =&gt; 'root',
        'password' =&gt; 'root',
        'database' =&gt; '',
        'prefix' =&gt; '',
        'port' =&gt; '/Applications/MAMP/tmp/mysql/mysql.sock',
    );

    var $production = array(
        'driver' =&gt; 'mysql',
        'persistent' =&gt; false,
        'encoding' =&gt; 'utf8',
        'host' =&gt; 'localhost',
        'login' =&gt; '',
        'password' =&gt; '',
        'database' =&gt; '',
        'prefix' =&gt; '',
        'port' =&gt; '',
    );

    public function __construct() {
        if(isset($_SERVER['SERVER_NAME'])) {
            switch($_SERVER['SERVER_NAME']) {
                // Are we working locally?
                case 'www.YOURLOCALURL.com':
                    $this-&gt;default = $this-&gt;local;
                    Configure::write('debug', 2);
                    break;
                case 'www.YOURLIVEURL.com':
                    $this-&gt;default = $this-&gt;production;
                    Configure::write('debug', 0);
                    break;
                default:
                    $this-&gt;default = $this-&gt;production;
                    Configure::write('debug', 0);
                    break;
            }
        } else {
            // If there's no SERVER_NAME we're probably using bake from the command line, so use local
            $this-&gt;default = $this-&gt;local;
        }
    }
</code></pre>

<p>As you can see we check the <code>$_SERVER['SERVER_NAME']</code> . Locally I like to work with <code>dev.domain.com</code> domains, but if you’re using some sort of <code>localhost</code> structure this will work fine as well. So, depending on the server(name) you’re on the correct database credentials are put into the <code>$default</code> config. Obviously, you can extend the database configs as much as you want. We usually work with 4 arrays: local, development, staging and production. As a bonus, we can set the <code>debug value</code> for these environments accordingly as well.</p>

<h2 id="thoughts">Thoughts?</h2>

<p>I have been considering putting this logic in the <code>bootstrap.php</code>, but not sure if this is where one would want this logic. Do you guys use a similar setup, or know ways to improve or extend this? Let me know in the comments!</p>


	<footer>
    <section>
  		
    </section>

    <section>
      
        <h1>Categories:</h1>
        <ul>
        
        


  
     
    	<li><a href="/categories.html#CakePHP-ref">
    		CakePHP <span>11</span>
    	</a></li>
    
  


        </ul>
      
    </section>

    <p class="gotop">
      <a href="#page">Back to Top</a>
    </p>
	</footer>

	


  <div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_developer = 1;
    var disqus_shortname = 'Mindthecode'; // required: replace example with your forum shortname
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>




</article>

      </section>
      <aside>
        <nav>
          <ul>
            
            
            


  
    
      
      	
      	<li><a href="/archive.html">Archive</a></li>
      	
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/categories.html">Categories</a></li>
      	
      
    
  
    
  
    
      
      	
      	<li><a href="/pages.html">Pages</a></li>
      	
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/tags.html">Tags</a></li>
      	
      
    
  



          </ul>
        </nav>
        <ul>
          <li class="contact"><a href="mailto:stef@mindthecode.com">stef@mindthecode.com</a></li>
        </ul>
      </aside>
      <footer class="main">
        <p>
          <small>Themed with <a href="http://sdb.github.com/jb-theme-ghminimal/">ghminimal</a> based on <a href="http://github.com/orderedlist/minimal/">minimal</a>. Powered by <a href="http://github.com/mojombo/jekyll">Jekyll</a> and <a href="http://pages.github.com/">GitHub Pages</a>.</small>
        </p>
      </footer>
    </div>
    <script src="/assets/themes/ghminimal/js/scale.fix.js"></script>

    
  </body>
</html>
